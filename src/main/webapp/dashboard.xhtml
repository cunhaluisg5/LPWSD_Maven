<ui:composition template="/WEB-INF/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:ms="http://xmlns.jcp.org/jsf/composite/mscomp"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <h2 class="page-header">Gerar Relatórios</h2>
        <br/>
        <ms:mensagem/>
        <h:form id="formPrincipal">

            <div align="center">
                <p:panel style="width: 80%">
                    <p:tabView id="tabMain" 
                               dynamic="true" 
                               activeIndex="#{graficoBean.index}"
                               orientation="left">

                        <p:tab> 
                            <f:facet name="title">
                                <h:outputText value="Livros Reservados"
                                              style="margin: 5px; vertical-align: middle"/>
                            </f:facet>

                            <!--<p:barChart model="#{graficoBean.bookReserved}" style="width: 100%; height: 500px;" widgetVar="01"/>-->

                            <p:panel header="Livros Reservados">
                                <h:panelGrid style="text-align: center">
                                    <p:outputLabel value="Gera um gráfico em PDF de todos os livros reservados nos últimos 3 meses."/>
                                    <br/>
                                    <p:commandButton immediate="true" 
                                                     value="Exportar Gráfico" 
                                                     action="#{graficoBean.gerarRelatorio}" 
                                                     ajax="false" 
                                                     icon="ui-icon-document"
                                                     onclick="this.form.target = '_blank'"/>      
                                </h:panelGrid>
                            </p:panel>

                        </p:tab>

                        <p:tab> 
                            <f:facet name="title">
                                <h:outputText value="Livros Emprestados"
                                              style="margin: 5px; vertical-align: middle"/>
                            </f:facet>
                            
                            <p:panel header="Livros Emprestados">
                                <h:panelGrid style="text-align: center">
                                    <p:outputLabel value="Gera um gráfico em PDF de todos os livros emprestados nos últimos 3 meses."/>
                                    <br/>
                                    <p:commandButton immediate="true" 
                                                     value="Exportar Gráfico" 
                                                     action="#{graficoBean.gerarRelatorio}" 
                                                     ajax="false" 
                                                     icon="ui-icon-document"
                                                     onclick="this.form.target = '_blank'"/>      
                                </h:panelGrid>
                            </p:panel>
                        </p:tab>

                        <p:tab> 
                            <f:facet name="title">
                                <h:outputText value="Livros Reservados - Categoria"
                                              style="margin: 5px; vertical-align: middle"/>
                            </f:facet>
                            
                            <p:panel header="Livros Reservados - Categoria">
                                <h:panelGrid style="text-align: center">
                                    <p:outputLabel value="Gera um gráfico em PDF de todos os livros reservados por categoria nos últimos 3 meses."/>
                                    <br/>
                                    <p:commandButton immediate="true" 
                                                     value="Exportar Gráfico" 
                                                     action="#{graficoBean.gerarRelatorio}" 
                                                     ajax="false" 
                                                     icon="ui-icon-document"
                                                     onclick="this.form.target = '_blank'"/>      
                                </h:panelGrid>
                            </p:panel>
                        </p:tab>

                        <p:tab> 
                            <f:facet name="title">
                                <h:outputText value="Livros Emprestados - Categoria"
                                              style="margin: 5px; vertical-align: middle"/>
                            </f:facet>
                            
                            <p:panel header="Livros Emprestados - Categoria">
                                <h:panelGrid style="text-align: center">
                                    <p:outputLabel value="Gera um gráfico em PDF de todos os livros emprestados por categoria nos últimos 3 meses."/>
                                    <br/>
                                    <p:commandButton immediate="true" 
                                                     value="Exportar Gráfico" 
                                                     action="#{graficoBean.gerarRelatorio}" 
                                                     ajax="false" 
                                                     icon="ui-icon-document"
                                                     onclick="this.form.target = '_blank'"/>      
                                </h:panelGrid>
                            </p:panel>
                        </p:tab>

                        <p:tab> 
                            <f:facet name="title">
                                <h:outputText value="Livros Reservados/Emprestados"
                                              style="margin: 5px; vertical-align: middle"/>
                            </f:facet>
                            
                            <p:panel header="Livros Reservados/Emprestados">
                                <h:panelGrid style="text-align: center">
                                    <p:outputLabel value="Gera um gráfico em PDF de todos os livros reservados e emprestados nos último mês."/>
                                    <br/>
                                    <p:commandButton immediate="true" 
                                                     value="Exportar Gráfico" 
                                                     action="#{graficoBean.gerarRelatorio}" 
                                                     ajax="false" 
                                                     icon="ui-icon-document"
                                                     onclick="this.form.target = '_blank'"/>      
                                </h:panelGrid>
                            </p:panel>
                        </p:tab>

                    </p:tabView>
                </p:panel>                
            </div>

        </h:form>

        <h:outputScript name="js/pdfmake.min.js" />
        <h:outputScript name="js/vfs_fonts.js" />

        <script>
            function export01() {
                var docDefinition = {
                    content: [
                        'Bar Chart',
                        {
                            image: $(PF('01').exportAsImage()).attr('src'),
                            width: 520
                        }
                    ]
                };
                pdfMake.createPdf(docDefinition).open();
                pdfMake.createPdf(docDefinition).download('Gráfico_01.pdf');
            }
        </script>
    </ui:define>
</ui:composition>